<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css">
  <title>WRSR - Калькулятор потребления</title>
</head>

<body data-bs-theme="dark">
  <div class="container py-5">
    <div class="card shadow rounded-4">
      <div class="card-body">
        <a href="/" class="text-decoration-none">
          Назад
        </a>
        <h3 class="card-title my-3">Калькулятор потребления</h3>
        <div class="mt-3">
          <div class="row g-3 mb-3">
            <div class="col-md-4">
              <label class="form-label">Количество жителей</label>
              <input type="number" class="form-control" id="citizens-count">
            </div>
            <div class="col-md-4">
              <label class="form-label">Средняя плодородность (в процентах)</label>
              <input type="number" class="form-control" id="fertility" value="100">
            </div>
            <div class="col-md-4">
              <label class="form-label">Погрешность (в процентах)</label>
              <input type="number" class="form-control" id="error" value="5">
            </div>
          </div>
          <div class="d-none" id="consumption-results">
            <ul class="list-group list-group-numbered">
              <li class="list-group-item d-flex justify-content-between align-items-start">
                <div class="ms-2 me-auto">
                  <div class="fw-bold">Пища</div>
                  <span id="mad-amount">
                  </span>
                </div>
              </li>
              <li class="list-group-item d-flex justify-content-between align-items-start">
                <div class="ms-2 me-auto">
                  <div class="fw-bold">Мясо</div>
                  <span id="meat-amount"></span>
                </div>
              </li>
              <li class="list-group-item d-flex justify-content-between align-items-start">
                <div class="ms-2 me-auto">
                  <div class="fw-bold">Одежда</div>
                  <span id="clothes-amount"></span>
                </div>
              </li>
              <li class="list-group-item d-flex justify-content-between align-items-start">
                <div class="ms-2 me-auto">
                  <div class="fw-bold">Алкоголь</div>
                  <span id="alco-amount"></span>
                </div>
              </li>
              <li class="list-group-item d-flex justify-content-between align-items-start">
                <div class="ms-2 me-auto">
                  <div class="fw-bold">Электричество</div>
                  Необходимо производить
                  <span class="fw-bold" id="elec-amount"></span>
                  электричества в день
                </div>
              </li>
              <li class="list-group-item d-flex justify-content-between align-items-start">
                <div class="ms-2 me-auto">
                  <div class="fw-bold">Совхоз</div>
                  Для прокорма жителей необходимо
                  <span class="fw-bold" id="area-amount"></span>
                  или
                  <span class="fw-bold" id="fields-amount"></span>
                </div>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script>
    // Constants
    const averageDaysPerMonth = 29.3;
    const foodConsumptionPerMonth = 0.00928;
    const meatConsumptionPerMonth = 0.00209;
    const clothesConsumptionPerYear = 0.004;
    const alcoholConsumptionPerYear = 0.014;
    const elecConsumptionPerMonth = 1.8478;
    const cropsPerHectare = 62;
    const cropsConsumptionPerMonth = 0.0195;
    const bigFieldArea = 4.81;


    // Math Functions
    function roundToHundredth(num) {
      return Math.round(num * 100) / 100;
    }
    function addError(val, rate) {
      return val * (1.0 + (rate/100));
    }

    // Count function
    function calculate(citizensCount, fertility, err, fieldArea) {
      const cropsConsumption = (citizensCount * cropsConsumptionPerMonth);
      const cropsPerHectareWithFertility = cropsPerHectare * (fertility/100);
      const areaOfFields = roundToHundredth((cropsConsumption * 12) / cropsPerHectareWithFertility);
      return {
        foodCons: roundToHundredth(addError(citizensCount * foodConsumptionPerMonth, err)),
        meatCons: roundToHundredth(addError(citizensCount * meatConsumptionPerMonth, err)),
        clothesCons: roundToHundredth(addError(citizensCount * (clothesConsumptionPerYear / 12), err)),
        alcoholCons: roundToHundredth(addError(citizensCount * (alcoholConsumptionPerYear / 12), err)),
        electricityCons: roundToHundredth(citizensCount * (elecConsumptionPerMonth / averageDaysPerMonth)),
        areaOfFields,
        fieldsCount: Math.ceil(addError(areaOfFields / fieldArea, err)),
      }
    }

    // Fields
    const foodField = document.getElementById("mad-amount");
    const meatField = document.getElementById("meat-amount");
    const clothesField = document.getElementById("clothes-amount");
    const alcoholField = document.getElementById("alco-amount");
    const elecField = document.getElementById("elec-amount");
    const areaField = document.getElementById("area-amount");
    const fieldsField = document.getElementById("fields-amount");
    const consumptionBlock = document.getElementById("consumption-results");

    // Inputs
    const citizensInput = document.getElementById("citizens-count");
    const fertilityInput = document.getElementById("fertility");
    const errInput = document.getElementById("error");
    
    // Place at fields
    function updateFields(res) {
      foodField.textContent = `${res.foodCons} тонн/мес`;
      meatField.textContent = `${res.meatCons} тонн/мес`;
      clothesField.textContent = `${res.clothesCons} тонн/мес`;
      alcoholField.textContent = `${res.alcoholCons} тонн/мес`;
      elecField.textContent = `${res.electricityCons} МВч`;
      areaField.textContent = `${res.areaOfFields} Га`;
      fieldsField.textContent = `${res.fieldsCount} больших полей`;
    }

    // Update HTML
    function update() {
      const citizensCount = parseInt(citizensInput.value);
      const fertility = parseInt(fertilityInput.value);
      const err = parseInt(errInput.value);
      if (
        !isNaN(citizensCount) &&
        !isNaN(fertility) &&
        !isNaN(err)
      ) {
        consumptionBlock.classList.remove("d-none");
        updateFields(calculate(citizensCount, fertility, err, bigFieldArea));
      } else {
        consumptionBlock.classList.add("d-none");
      }
    }
    
    citizensInput.addEventListener("input", update);
    fertilityInput.addEventListener("input", update);
    errInput.addEventListener("input", update);
  </script>
</body>

</html>